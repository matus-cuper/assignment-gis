<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>

    <link rel="stylesheet" type="text/css" href="index.css">

    <title>Projekt na PDT</title>
  </head>

  <body>

    <div id="mapid"></div>

    <form action="">
      <input type="radio" id="usecase1" name="usecase" value="uc1">Points</input>
      <input type="radio" id="usecase2" name="usecase" value="uc2">Rectangles</input>
      <input type="radio" id="usecase3" name="usecase" value="uc3">Paths</input>
    </form>

    <div class="checkbox-group required">
      <input type="checkbox" name="entity" value="bars">Bars</input>
      <input type="checkbox" name="entity" value="hotels">Hotels</input>
      <input type="checkbox" name="entity" value="restaurants">Restaurants</input>
    </div>

    <form>
      Distance (between 1 and 999 999):
      <input type="number" name="distance" min="1" max="999999">
    </form>

    <form>
      Limit (between 1 and 9 999):
      <input type="number" name="limit" min="1" max="9999">
    </form>

    <script>
      var mymap = L.map('mapid').setView([48.1472665, 17.1088840], 15);
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: 'pk.eyJ1IjoiY3VwbyIsImEiOiJjajhibW9pczQwc3M0MnFwOGo3dDFncWwzIn0.VlG1EafnmV5KoZFf_1EUBQ'
      }).addTo(mymap);

      // var marker = L.marker([48.1475101711469, 17.1106751964688]).addTo(mymap);

      var getJSON = function(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
        xhr.responseType = 'json';
        xhr.onload = function() {
          var status = xhr.status;
          if (status === 200) {
            callback(null, xhr.response);
          } else {
            callback(status, xhr.response);
          }
        };
        xhr.send();
      };


      var popup = L.popup();

      function onMapClick(e) {
        getJSON('http://127.0.0.1:3000/api/points?amenity[]=hotels&amenity[]=bars&lon=' + e.latlng['lng'] + '&lat=' + e.latlng['lat'] + '&distance=40&limit=5',
        function(err, data) {
          if (err !== null) {
            console.log('Error occurred during getting response from nodejs: ' + err);
          } else {
            for (d in data) {
              console.log(data[d]);
            }
          }
        });

        popup
          .setLatLng(e.latlng)
          .setContent("You clicked the map at " + e.latlng.toString())
          .openOn(mymap);
      };

      mymap.on('click', onMapClick);

    </script>

    <h1>Ahoj</h1>
  </body>
</html>
